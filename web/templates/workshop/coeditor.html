{% extends 'base.html' %}
{% block title %}协作编辑{% endblock %}
{% block content %}
<div class="container mt-4">
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">首页</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('workshop.home') }}">工坊</a></li>
      {% if work_id %}
      <li class="breadcrumb-item"><a href="/workshop/work/{{ work_id }}">作品详情</a></li>
      {% endif %}
      <li class="breadcrumb-item active">协作编辑</li>
    </ol>
  </nav>
  <div class="card">
    <div class="card-header">
      <h4>协作编辑</h4>
    </div>
    <div class="card-body">
      <form id="coeditor-form" autocomplete="off">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="mb-3">
          <label class="form-label" for="title">标题</label>
          <input type="text" class="form-control" name="title" id="title" placeholder="请输入作品标题" required>
        </div>
        <div class="mb-3">
          <label class="form-label" for="description">作品说明</label>
          <textarea class="form-control" name="description" id="description" rows="3" placeholder="支持Markdown"></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label" for="content">正文内容（支持#分章节）</label>
          <textarea class="form-control" name="content" id="content" rows="12" placeholder="正文内容"></textarea>
        </div>
        <div class="d-flex justify-content-end align-items-center mt-4">
          <button type="button" class="btn btn-primary me-2" id="save-btn">保存草稿</button>
          <button type="button" class="btn btn-success" id="submit-btn">提交编辑</button>
        </div>
      </form>
      <!-- 发布设置Modal：实名/匿名选择 -->
      <div class="modal fade" id="publishModal" tabindex="-1" aria-labelledby="publishModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="publishModalLabel" style="color: #212529;">提交设置</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
            </div>
            <div class="modal-body" style="color: #212529;">
              <form id="publish-form">
                <div class="mb-3">
                  <label class="form-label">提交方式</label><br>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="is_anonymous" id="realname" value="0" checked>
                    <label class="form-check-label" for="realname">实名提交</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="is_anonymous" id="anonymous" value="1">
                    <label class="form-check-label" for="anonymous">匿名提交</label>
                  </div>
                </div>
                <div class="mb-3 form-check">
                  <input type="checkbox" class="form-check-input" id="agree-protocol" name="agree_protocol">
                  <label class="form-check-label" for="agree-protocol">我已阅读并同意 <a href="/docs/publish_protocol" target="_blank">平台作品发布协议</a></label>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
              <button type="button" class="btn btn-success" id="modal-submit-btn">提交</button>
            </div>
          </div>
        </div>
      </div>
      <hr>
      <div id="stats-area" class="mt-3">
        <h5>统计信息</h5>
        <div>总字数：<span id="stat-words">0</span>，中文字符：<span id="stat-cn">0</span>，英文单词：<span id="stat-en">0</span>，丰富度：<span id="stat-rich">0</span></div>
        <div>高频词：<span id="stat-top"></span>，敏感词：<span id="stat-sensitive"></span></div>
      </div>
      <hr>
      <div id="sections-area" class="mt-3">
        <h5>章节目录</h5>
        <ul id="section-list"></ul>
      </div>
    </div>
  </div>
</div>
<script src="/static/js/bootstrap.bundle.min.js"></script>
<script src="/static/js/coeditor.js?v={{ static_version }}"></script>
{% endblock %}
