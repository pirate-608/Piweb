{% extends 'base.html' %}
{% block title %}发现作品{% endblock %}
{% block content %}
<div class="container py-4">
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">首页</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('workshop.home') }}">工坊</a></li>
      <li class="breadcrumb-item active">发现</li>
    </ol>
  </nav>
  <h2 class="mb-4">发现作品</h2>
    {% if current_user.is_authenticated and current_user.is_admin %}
    <div class="mb-3">
      <a href="{{ url_for('workshop_admin.admin_dashboard') }}" class="btn btn-danger">进入工坊管理后台</a>
    </div>
    {% endif %}
  <!-- 搜索与筛选区 -->
  <form id="searchForm" class="row g-2 align-items-center mb-3">
    <div class="col-md-3 col-12">
      <input type="text" class="form-control" name="keyword" placeholder="搜索标题/作者/关键词...">
    </div>
    <div class="col-md-2 col-6">
      <select class="form-select" name="theme">
        <option value="">全部主题</option>
        <option value="社会">社会</option>
        <option value="科技">科技</option>
        <option value="文学">文学</option>
        <!-- 可扩展更多主题 -->
      </select>
    </div>
    <div class="col-md-2 col-6">
      <select class="form-select" name="is_collab">
        <option value="">全部类型</option>
        <option value="1">协作作品</option>
        <option value="0">个人作品</option>
      </select>
    </div>
    <div class="col-md-2 col-6">
      <select class="form-select" name="sort">
        <option value="latest">最新</option>
        <option value="hot">热门</option>
        <option value="likes">点赞最多</option>
      </select>
    </div>
    <div class="col-md-2 col-6">
      <button type="submit" class="btn btn-primary w-100">搜索</button>
    </div>
  </form>
  <!-- Tab分区 -->
  <ul class="nav nav-tabs mb-3" id="worksTab">
    <li class="nav-item">
      <a class="nav-link active" data-sort="latest" href="#">最新</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-sort="hot" href="#">热门</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-sort="likes" href="#">点赞最多</a>
    </li>
  </ul>
  <!-- 瀑布流卡片区 -->
  <div id="worksGrid" class="row row-cols-1 row-cols-md-3 g-4"></div>
  <div id="skeletonLoader" style="display:none">
    <div class="col"><div class="skeleton"></div></div>
    <div class="col"><div class="skeleton"></div></div>
    <div class="col"><div class="skeleton"></div></div>
  </div>
  <!-- 分页 -->
  <nav>
    <ul class="pagination justify-content-center mt-4" id="pagination"></ul>
  </nav>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
      .work-card {
        transition: box-shadow .2s, transform .2s, border-color .2s;
        border-radius: 1.25rem;
        animation: fadeInUp .5s cubic-bezier(.23,1.01,.32,1) both;
        border: 1.5px solid #f0f2f5;
      }
      .work-card:hover {
        box-shadow: 0 0.5rem 1.5rem rgba(80,120,200,.15),0 0.2rem 0.5rem rgba(0,0,0,.08);
        transform: translateY(-2px) scale(1.01);
        border-color: #b6c6f5;
      }
      @keyframes fadeInUp {
        from { opacity: 0; transform: translate3d(0, 40px, 0); }
        to { opacity: 1; transform: none; }
      }
      .theme-bar { width: 100%; min-height: 6px; margin-bottom: 2px; border-radius: 12px 12px 0 0; }
      .avatar-circle {
        width: 32px; height: 32px; border-radius: 50%; background: #f0f2f5;
        display: flex; align-items: center; justify-content: center;
        font-weight: bold; color: #4e73df; font-size: 1.1rem;
        box-shadow: 0 1px 2px rgba(0,0,0,.04);
        border: 1.5px solid #e3e6f0;
      }
      .avatar-initial { font-size: 1.1rem; }
      .work-desc { cursor: pointer; transition: color .2s; }
      .work-desc:not(.text-truncate) { white-space: normal; color: #222; background: #f8f9fa; border-radius: 4px; padding: 2px 4px; }
      .work-keyword { cursor: pointer; transition: background .2s, color .2s; }
      .work-keyword.bg-warning { font-weight: bold; }
      .work-card .card-footer { background: #fff; border-top: none; }
      .work-card .bi-eye, .work-card .bi-heart { vertical-align: -0.1em; }
      /* 响应式优化 */
      @media (max-width: 768px) {
        .row-cols-md-3 > .col { flex: 0 0 100%; max-width: 100%; }
        .work-card { margin-bottom: 1rem; }
      }
      @media (max-width: 992px) and (min-width: 769px) {
        .row-cols-md-3 > .col { flex: 0 0 50%; max-width: 50%; }
      }
      /* 骨架屏样式 */
      .skeleton {
        background: linear-gradient(90deg, #f0f2f5 25%, #e3e6f0 37%, #f0f2f5 63%);
        background-size: 400% 100%;
        animation: skeleton-loading 1.2s ease-in-out infinite;
        border-radius: 1.25rem;
        min-height: 180px;
        margin-bottom: 1rem;
      }
      @keyframes skeleton-loading {
        0% { background-position: 100% 50%; }
        100% { background-position: 0 50%; }
      }
    </style>
<script src="{{ url_for('static', filename='js/workshop_discover.js') }}"></script>
{% endblock %}
