{% extends "base.html" %}

{% block content %}
<div class="p-5 mb-4 rounded-3" style="background-color: #1e1e1e; color: #e0e0e0; border: 1px solid #333;">
    <div class="container-fluid py-5">
        <h1 class="display-5 fw-bold text-white">Night's Watch Window (NWW)</h1>
        <p class="col-md-8 fs-4 text-muted">å®ˆå¤œäººä¹‹çª— â€”â€” è‡´åŠ›äºä¸º67656ä¸ªç”¨æˆ·å¼€å‘çš„çº¿ä¸Šå¤œç©ºã€‚</p>
        <div class="d-grid gap-2 d-md-flex justify-content-md-start mt-4">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('exam.start_exam') }}" class="btn btn-outline-light btn-lg px-4 me-md-2">âš”ï¸ å¼€å§‹è¯•ç‚¼</a>
                {% if current_user.is_admin %}
                    <a href="{{ url_for('admin_bp.add') }}" class="btn btn-outline-secondary btn-lg px-4">ğŸ“œ å‘å¸ƒä»»åŠ¡</a>
                {% endif %}
            {% else %}
                <a href="{{ url_for('auth.login') }}" class="btn btn-outline-light btn-lg px-4 me-md-2">ç™»å½•</a>
                <a href="{{ url_for('auth.register') }}" class="btn btn-outline-secondary btn-lg px-4">æ³¨å†Œ</a>
            {% endif %}
        </div>
    </div>
</div>

<!-- Announcements Section -->
{% if announcement or current_user.is_admin %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm border-info">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h5 class="my-0"><i class="bi bi-megaphone"></i> ç³»ç»Ÿå…¬å‘Š</h5>
                {% if current_user.is_admin %}
                <button class="btn btn-sm btn-light text-info" type="button" data-bs-toggle="collapse" data-bs-target="#editAnnouncementForm" aria-expanded="false" aria-controls="editAnnouncementForm">
                    âœï¸ ç¼–è¾‘å…¬å‘Š
                </button>
                {% endif %}
            </div>
            
            {% if current_user.is_admin %}
            <div class="collapse" id="editAnnouncementForm">
                <div class="card-body border-bottom bg-light">
                    <form action="{{ url_for('admin_bp.update_announcement') }}" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="mb-3">
                            <label for="announcementContent" class="form-label">å…¬å‘Šå†…å®¹</label>
                            <select class="form-select mb-2" name="mode" id="announcementMode">
                                <option value="html" {% if announcement_mode == 'html' %}selected{% endif %}>HTML</option>
                                <option value="markdown" {% if announcement_mode == 'markdown' %}selected{% endif %}>Markdown</option>
                            </select>
                            <textarea class="form-control" id="announcementContent" name="content" rows="4">{{ announcement_raw or '' }}</textarea>
                            <div class="form-text">å¯é€‰ HTML æˆ– Markdown ç¼–è¾‘æ¨¡å¼ã€‚Markdown æ”¯æŒæ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç å—ç­‰æ’ç‰ˆã€‚</div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">ä¿å­˜å…¬å‘Š</button>
                    </form>
                </div>
            </div>
            {% endif %}
            
            {% if announcement %}
            <div class="card-body">
                <div class="announcement-content">
                    {{ announcement|safe }}
                </div>
            </div>
            {% elif current_user.is_admin %}
            <div class="card-body text-center text-muted py-2">
                <small>æš‚æ— å…¬å‘Šï¼Œç‚¹å‡»å³ä¸Šè§’ç¼–è¾‘æŒ‰é’®å‘å¸ƒæ–°å…¬å‘Šã€‚</small>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- User Guide Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="my-0 fw-normal">ğŸ“– ç”¨æˆ·æŒ‡å—</h4>
                {% if current_user.is_admin %}
                <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#editGuideForm" aria-expanded="false" aria-controls="editGuideForm">
                    âœï¸ ç¼–è¾‘æŒ‡å—
                </button>
                {% endif %}
            </div>
            
            {% if current_user.is_admin %}
            <div class="collapse" id="editGuideForm">
                <div class="card-body border-bottom bg-light">
                    <form action="{{ url_for('admin_bp.update_guide') }}" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="mb-3">
                            <label for="guideContent" class="form-label">æŒ‡å—å†…å®¹ (æ”¯æŒ HTML)</label>
                            <textarea class="form-control" id="guideContent" name="content" rows="10">{{ user_guide or '' }}</textarea>
                            <div class="form-text">æ‚¨å¯ä»¥ç›´æ¥ç¼–å†™ HTML ä»£ç æ¥æ’ç‰ˆæŒ‡å—å†…å®¹ã€‚</div>
                        </div>
                        <button type="submit" class="btn btn-primary">ä¿å­˜æ›´æ–°</button>
                    </form>
                </div>
            </div>
            {% endif %}
            
            {% if user_guide %}
            <div class="card-body">
                <div class="user-guide-content">
                    {{ user_guide|safe }}
                </div>
            </div>
            {% elif current_user.is_admin %}
            <div class="card-body text-center text-muted py-4">
                <p class="mb-0">æš‚æ— ç”¨æˆ·æŒ‡å—ï¼Œè¯·ç‚¹å‡»"ç¼–è¾‘æŒ‡å—"æŒ‰é’®è¿›è¡Œæ·»åŠ ã€‚</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
<div class="row align-items-md-stretch">
    <div class="col-md-12">
        <div class="h-100 p-5 bg-light border rounded-3 text-dark">
            <h2>å…³äºæœ¬é¡¹ç›®</h2>
            <p>æœ¬ç³»ç»Ÿé‡‡ç”¨ C è¯­è¨€ç¼–å†™æ ¸å¿ƒé˜…å·é€»è¾‘ï¼ŒPython Flask æä¾› Web äº¤äº’ç•Œé¢ï¼ŒDocker å®¹å™¨æä¾›å¼€å‘å’Œéƒ¨ç½²ç¯å¢ƒï¼Œæ•°æ®åº“ä½¿ç”¨ä¸“ä¸šçº§ PostgreSQLã€‚</p>
            <hr>
            <h4>å¼€å‘è€…è”ç³»æ–¹å¼</h4>
            <ul class="list-unstyled">
                <li class="mb-2">
                    <strong>é‚®ç®±ï¼š</strong> 
                    <a href="mailto:huangmaidou608@outlook.com" class="text-decoration-none">huangmaidou608@outlook.com</a>
                </li>
                <li class="mb-2">
                    <strong>é¡¹ç›®ä»“åº“ï¼š</strong> 
                    <a href="https://github.com/pirate-608/auto-grading-system" target="_blank" class="text-decoration-none">https://github.com/pirate-608/auto-grading-system.git</a>
                </li>
            </ul>
            <a href="https://github.com/pirate-608/auto-grading-system" target="_blank" class="btn btn-dark">å‰å¾€ GitHub ä»“åº“</a>
        </div>
    </div>
</div>
{# ä»ªè¡¨ç›˜å·²è¿ç§»è‡³ç­”é¢˜ä¸»é¡µ #}
{% endblock %}
